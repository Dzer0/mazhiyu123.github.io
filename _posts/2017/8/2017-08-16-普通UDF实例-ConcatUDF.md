---
layout:     post
random-img: true
title:      普通UDF实例-ConcatUDF
date:       2017-08-16 16:58:00
author:     mazhiyu
description: 普通UDF实例-ConcatUDF
keywords: MaxComputeSQL
tags:
    - MaxComputeSQL
    - UDF
---

实现 UDF 需要继承 com.aliyun.odps.udf.UDF 类，并实现 evaluate 方法。evaluate 方法必须是非 static的public 方法 。Evaluate 方法的参数和返回值类型将作为 SQL 中 UDF 的函数签名 。这意味着用户可以在 UDF 中实现多个 evaluate 方法，在调用 UDF 时，框架会依据 UDF 调用的参数类型匹配正确的 evaluate 方法 。

简单的UDF例子

```
package com.mzy.udfexample;

import com.aliyun.odps.udf.UDF;

public class ConcatUDF extends UDF {

	// TODO define parameters and return type, e.g., public Long evaluate(Long a, Long b)
	public String evaluate(String taxiid, Double latitude, Double longtitude,Long haspassenger, String time){
		int i= 0;
		return "第 " + (++i) + " 条记录是： " + " 出租车ID： " + taxiid + " 维度： " 
				+ latitude + " 经度： " + longtitude + " 是否载客: " +haspassenger+ " 时间： " + time; 
	}

}


```

运行的结果

```
第 1 条记录是：  出租车ID： 1 维度： 30.624813 经度： 104.136589 是否载客: 1 时间： 2014/8/3 21:19:46
第 1 条记录是：  出租车ID： 1 维度： 30.624815 经度： 104.136585 是否载客: 1 时间： 2014/8/3 21:21:18
第 1 条记录是：  出租车ID： 1 维度： 30.624815 经度： 104.136587 是否载客: 1 时间： 2014/8/3 21:20:48
第 1 条记录是：  出租车ID： 1 维度： 30.624815 经度： 104.136639 是否载客: 1 时间： 2014/8/3 21:17:14
第 1 条记录是：  出租车ID： 1 维度： 30.624816 经度： 104.136569 是否载客: 1 时间： 2014/8/3 21:22:50
第 1 条记录是：  出租车ID： 1 维度： 30.624816 经度： 104.136574 是否载客: 1 时间： 2014/8/3 21:22:19
第 1 条记录是：  出租车ID： 1 维度： 30.624816 经度： 104.136577 是否载客: 1 时间： 2014/8/3 21:21:49
第 1 条记录是：  出租车ID： 1 维度： 30.624818 经度： 104.136564 是否载客: 1 时间： 2014/8/3 21:23:20
第 1 条记录是：  出租车ID： 1 维度： 30.624818 经度： 104.136621 是否载客: 1 时间： 2014/8/3 21:15:42
第 1 条记录是：  出租车ID： 1 维度： 30.62482 经度： 104.136631 是否载客: 1 时间： 2014/8/3 21:16:43
第 1 条记录是：  出租车ID： 1 维度： 30.62482 经度： 104.136644 是否载客: 1 时间： 2014/8/3 21:16:13
第 1 条记录是：  出租车ID： 1 维度： 30.624823 经度： 104.136582 是否载客: 1 时间： 2014/8/3 21:15:11
第 1 条记录是：  出租车ID： 1 维度： 30.624826 经度： 104.136556 是否载客: 1 时间： 2014/8/3 21:23:51
第 1 条记录是：  出租车ID： 1 维度： 30.624828 经度： 104.136552 是否载客: 1 时间： 2014/8/3 21:24:51
第 1 条记录是：  出租车ID： 8541 维度： 30.608332 经度： 104.080752 是否载客: 0 时间： 2014/8/3 07:24:43
第 1 条记录是：  出租车ID： 8541 维度： 30.608363 经度： 104.076951 是否载客: 0 时间： 2014/8/3 07:05:57
第 1 条记录是：  出租车ID： 8541 维度： 30.608363 经度： 104.080939 是否载客: 0 时间： 2014/8/3 07:08:58
```
但是计算第几条记录的i，只是进行了一次加运算，为啥？

但是，把i定义在evaluate（）方法的外面就是可以的

```
第 1 条记录是：  出租车ID： 1 维度： 30.624806 经度： 104.136604 是否载客: 1 时间： 2014/8/3 21:18:46
第 2 条记录是：  出租车ID： 1 维度： 30.624809 经度： 104.136612 是否载客: 1 时间： 2014/8/3 21:18:15
第 3 条记录是：  出租车ID： 1 维度： 30.624811 经度： 104.136587 是否载客: 1 时间： 2014/8/3 21:20:17
第 4 条记录是：  出租车ID： 1 维度： 30.624811 经度： 104.136596 是否载客: 1 时间： 2014/8/3 21:19:16
第 5 条记录是：  出租车ID： 1 维度： 30.624811 经度： 104.136619 是否载客: 1 时间： 2014/8/3 21:17:44
第 6 条记录是：  出租车ID： 1 维度： 30.624813 经度： 104.136589 是否载客: 1 时间： 2014/8/3 21:19:46
第 7 条记录是：  出租车ID： 1 维度： 30.624815 经度： 104.136585 是否载客: 1 时间： 2014/8/3 21:21:18
第 8 条记录是：  出租车ID： 1 维度： 30.624815 经度： 104.136587 是否载客: 1 时间： 2014/8/3 21:20:48
第 9 条记录是：  出租车ID： 1 维度： 30.624815 经度： 104.136639 是否载客: 1 时间： 2014/8/3 21:17:14
第 10 条记录是：  出租车ID： 1 维度： 30.624816 经度： 104.136569 是否载客: 1 时间： 2014/8/3 21:22:50
第 11 条记录是：  出租车ID： 1 维度： 30.624816 经度： 104.136574 是否载客: 1 时间： 2014/8/3 21:22:19
第 12 条记录是：  出租车ID： 1 维度： 30.624816 经度： 104.136577 是否载客: 1 时间： 2014/8/3 21:21:49
第 13 条记录是：  出租车ID： 1 维度： 30.624818 经度： 104.136564 是否载客: 1 时间： 2014/8/3 21:23:20
第 14 条记录是：  出租车ID： 1 维度： 30.624818 经度： 104.136621 是否载客: 1 时间： 2014/8/3 21:15:42
第 15 条记录是：  出租车ID： 1 维度： 30.62482 经度： 104.136631 是否载客: 1 时间： 2014/8/3 21:16:43
第 16 条记录是：  出租车ID： 1 维度： 30.62482 经度： 104.136644 是否载客: 1 时间： 2014/8/3 21:16:13
第 17 条记录是：  出租车ID： 1 维度： 30.624823 经度： 104.136582 是否载客: 1 时间： 2014/8/3 21:15:11
第 18 条记录是：  出租车ID： 1 维度： 30.624826 经度： 104.136556 是否载客: 1 时间： 2014/8/3 21:23:51
第 19 条记录是：  出租车ID： 1 维度： 30.624828 经度： 104.136552 是否载客: 1 时间： 2014/8/3 21:24:51
第 20 条记录是：  出租车ID： 8541 维度： 30.608332 经度： 104.080752 是否载客: 0 时间： 2014/8/3 07:24:43
第 21 条记录是：  出租车ID： 8541 维度： 30.608363 经度： 104.076951 是否载客: 0 时间： 2014/8/3 07:05:57
```